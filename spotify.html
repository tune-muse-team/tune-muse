<!DOCTYPE html>
<html>
    <head>
        <title> Spotify API functionality</title>
    </head>
    <body>
        <h2> Spotify API TEST</h2>
        <button id="Search"> LOOK FOR SONG</button>
        <input id="SINGER" type=""text" placeholder="Enter Singer">
        <input id="SONG" type=""text" placeholder="Enter Song Name">
        <spotify_section id="SPOTRESU"> </spotify_section>
        <script>
            /* This contains the variables for the HTML Elements, and Variables for Musicean Name and Song Name*/
var SearchButt = document.getElementById("Search"); //Search Button
var SINGER = document.getElementById("SINGER"); //The text where you enter a singers name from the CHATGPT
var SONG = document.getElementById("SONG"); //Where you enter the song from the CHATGPT
var spotiOUTPUT = document.getElementById("SPOTRESU"); //Just for the Output
var MUSICEAN = SINGER.value;
var SONGTITLE = SONG.value;
SearchButt.addEventListener("click", searchSpotify);
//Reference https://developer.spotify.com/documentation/web-api/tutorials/client-credentials-flow chagned buffer to btoa since it is running on web Javascript
var authOptions = {
  url: 'https://accounts.spotify.com/api/token',
  headers: {
    'Authorization': 'Basic ' + (btoa(CLI_ID + ':' + SEC_ID).toString('base64'))
  },
  form: {
    grant_type: 'client_credentials'
  },
  json: true
};
//https://developer.spotify.com/documentation/web-api/tutorials/client-credentials-flow from the reference request.post is not a function so was changed to fetch
fetch (authOptions, async function(error, response, body) {
  if (!error && response.statusCode === 200) {
    var token = data.access_token;
  }
});
            //Don't worry about these Variables
            var CLI_ID = "95dac2ec667f4f81b55f7a7ffe19070f"; 
            var SEC_ID = "1ac2264050d94b0ca2b1367722c36ef1";
            API_link = 'https://accounts.spotify.com/api/token';
            //Added the search query "q"
            Spotify_Search_Endpoint = 'https://api.spotify.com/v1/search?q=';

    //This is whre the song will be displayed 
    //Reference: https://developer.spotify.com -> embeded API
            //https://developer.spotify.com/documentation/embeds/tutorials/using-the-iframe-api

    function SpotifyPRINTSONG(track) {
    spotiOUTPUT.innerHTML = '<DISPLAY_TRACK class="result-item">' +
        '<h1>' + track.artists.map(function (artist) {
            return artist.name;
        }).join(", ") + '</h1>' +
        '<h1>' + track.name + '</h1>' +
        '<iframe src="https://open.spotify.com/embed/track/' + track.id + '" width=500 height=500 allow="encrypted-media">' +
        '</DISPLAY_TRACK>';
    }
            Combines all the functions together 
async function searchSpotify() {
    var SONGTITLE = SONG.value;
     var KeyToken = await Token();
    var track = await SONGSEARCH(MUSICEAN, SONGTITLE, KeyToken);
    SpotifyPRINTSONG(track);
}

 //Retriving Token inspired from https://stackoverflow.com/questions/70266495/first-time-doing-post-request-with-spotifys-api and https://developer.spotify.com/documentation/web-api/tutorials/client-credentials-flow
async function Token() {
    var response = await fetch(API_link, {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded",
            "Authorization": "Basic " + btoa(CLI_ID + ":" + SEC_ID)
        },
        body: "grant_type=client_credentials"
    });

    var data = await response.json();
    return data.access_token;
}
//Code inspired from https://stackoverflow.com/questions/45007790/post-request-to-spotify-api?rq=3 
 //https://stackoverflow.com/questions/70266495/first-time-doing-post-request-with-spotifys-api
var SONGSEARCH = async function (MUSICEAN, SONG, Token) {
    var response = await fetch(Spotify_Search_Endpoint + MUSICEAN + "+track:" + SONG + "&type=track", {
        headers: {
            "Authorization": "Bearer " + Token
        }
    });
    //This Part of the code selects the first song in the search results of the spotify search chaing [0], will  only select the 2nd, 3rd etc..
    var search = await response.json();
    return search.tracks.items[0]
}
        </script>
    </body>
</html>
